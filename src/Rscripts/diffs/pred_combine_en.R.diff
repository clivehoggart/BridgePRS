14c14
<     
---
> 
93a94
> 
104,121c105
< 
< 
< # TADE EDIT - Renaming LogFile For Pred1/2 
< 
< #logfile <- paste0(opt$outfile,"_weighted_combined_var_explained.log")
< if( is.null(opt$pred2) ){
<     logfile <- paste0(opt$outfile,"_var_explained.log")
<     wtfile  <- paste0(opt$outfile,"_snp_weights.dat")
< 
< }else{                   
<     logfile <- paste0(opt$outfile,"_weighted_combined_var_explained.log")
<     wtfile <- paste0(opt$outfile,"_weighted_combined_snp_weights.dat") 
< } 
<        
< 
< 
< 
< 
---
> logfile <- paste0(opt$outfile,"_weighted_combined_var_explained.log")
122a107
> 
145c130
< nfolds <- ifelse( nrow(target)<2000, nrow(target), 50 )
---
> nfolds <- ifelse( nrow(target)<500, nrow(target), 500 )
187d171
< # alpha 
191a176,183
> 
> #    ptr <- c( 1, grep("_0.5_", colnames(pred1)),
> #             grep("_1_", colnames(pred1)),
> #             grep("_2_", colnames(pred1)),
> #             grep("_5_", colnames(pred1)),
> #             grep("_10_", colnames(pred1)) )
> #    pred1 <- pred1[,ptr]
> 
205a198
> 
226,234c219,222
<         # TADE - NEED THE PHENOTYPE AND COLUMN NAMES FOR DOWNSTREAM ANALYSIS #  
<         out <- data.frame( target$IID, target[,opt$pheno.name], prs.ridge, prs.ridge1, prs.ridge2, prs.weighted )
<         colnames(out) <- c('---','pheno','prs','ridge1','ridge2','weighted')
< 
<         # TADE - NEED THE COLUMN NAMES FOR DOWNSTREAM  
<         #write.table( out,paste0(opt$outfile,"_weighted_combined_preds.dat"),col.names=FALSE, row.names=FALSE, quote=FALSE )
<         
<         #my_data <- data.frame( target$IID, target[,opt$pheno.name], prs.ridge1)
<         write.table( out,paste0(opt$outfile,"_weighted_combined_preds.dat"),row.names=FALSE, quote=FALSE )
---
>         out <- data.frame( target$IID, prs.ridge, prs.ridge1, prs.ridge2, prs.weighted )
>         write.table( out,
>                     paste0(opt$outfile,"_weighted_combined_preds.dat"),
>                     col.names=FALSE, row.names=FALSE, quote=FALSE )
248,257c236
< 
<         # TADE - Renaming Again (not weighted/combined) 
<         write.csv( out, paste0(opt$outfile,"_var_explained.txt"), row.names=TRUE )
< 
<         # TADE - Adding Single Stage Preds for single stage # 
<         data <- data.frame( target[  ,opt$pheno.name], prs.ridge1, covs )      
<         my_data <- data.frame( target$IID, target[,opt$pheno.name], prs.ridge1)
<         colnames(my_data) <- c('---','pheno','prs')                                       
<         write.table( my_data, paste0(opt$outfile,"_preds.dat"), row.names = FALSE, quote=FALSE)
< 
---
>         write.csv( out, paste0(opt$outfile,"_combined_var_explained.txt"), row.names=TRUE )
267,270c246,249
<     #write.table( alpha.weights2,  paste0(opt$outdir,"_alpha_weights.dat"), row.names=TRUE )
<     #write.table( lambda.weights2, paste0(opt$outdir,"_lambda_weights.dat"), row.names=TRUE )
<     write.table( alpha.weights2,  paste0(opt$outfile,"_alpha_weights.dat"), row.names=TRUE )
<     write.table( lambda.weights2, paste0(opt$outfile,"_lambda_weights.dat"), row.names=TRUE )
---
>     write.table( alpha.weights2,
>                 paste0(opt$outfile,"_alpha_weights.dat"), row.names=TRUE )
>     write.table( lambda.weights2,
>                 paste0(opt$outfile,"_lambda_weights.dat"), row.names=TRUE )
295,297c274,279
<     write.table( tau.weights, paste0(opt$outfile,"_tau_weights.dat"), row.names=TRUE )
<     write.table( alpha.weights, paste0(opt$outfile,"_alpha_weights.dat"), row.names=TRUE )
<     write.table( lambda.weights, paste0(opt$outfile,"_lambda_weights.dat"), row.names=TRUE )
---
>     write.table( tau.weights,
>                 paste0(opt$outfile,"_tau_weights.dat"), row.names=TRUE )
>     write.table( alpha.weights,
>                 paste0(opt$outfile,"_alpha_weights.dat"), row.names=TRUE )
>     write.table( lambda.weights,
>                 paste0(opt$outfile,"_lambda_weights.dat"), row.names=TRUE )
303c285,286
<     w.ridge11 <- w.ridge[1:length(w.ridge1)] * probM.ridge[1] + w.ridge1 * probM.ridge[2]
---
>     w.ridge11 <- w.ridge[1:length(w.ridge1)] * probM.ridge[1] +
>         w.ridge1 * probM.ridge[2]
305c288,289
<     w.ridge22 <- w.ridge[-(1:length(w.ridge1))] * probM.ridge[1] + w.ridge2 * probM.ridge[3]
---
>     w.ridge22 <- w.ridge[-(1:length(w.ridge1))] * probM.ridge[1] +
>         w.ridge2 * probM.ridge[3]
308,310d291
< 
< #print('hello') 
< #match
356c337
<      
---
> 
358,359d338
<     
<     ## NOTE - THIS CAUSES AN ERROR WHEN RAN WITH SINGLE PRIOR RESULT - tmp, getElement4 ##  
361c340,342
<     w.beta.bar <- paste( sapply(tmp,getElement,1),sapply(tmp,getElement,2),sapply(tmp,getElement,3), sep='_' )
---
>     w.beta.bar <- paste( sapply(tmp,getElement,1),
>                         sapply(tmp,getElement,2),
>                         sapply(tmp,getElement,3), sep='_' )
365d345
<     
382c362
<     
---
> 
395c375,377
< write.table( beta.bar.genome,wtfile,col.names=TRUE, row.names=FALSE, quote=FALSE )
---
> write.table( beta.bar.genome,
>           paste0(opt$outfile,"_weighted_combined_snp_weights.dat"),
>           col.names=TRUE, row.names=FALSE, quote=FALSE )
